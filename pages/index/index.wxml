<!--
  ä¸»é¡µé¢æ¨¡æ¿æ–‡ä»¶
  @description å±•ç¤ºé¸¡å°¾é…’é…æ–¹åˆ—è¡¨å’Œæœç´¢åŠŸèƒ½
  @author å¼€å‘å›¢é˜Ÿ
  @version 2.0.0
-->

<view class="container fade-in">
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading">
    <loading class="loading-spinner" type="dot-gray" />
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <text class="error-text">{{error.message}}</text>
    <text class="error-context">æ“ä½œï¼š{{error.context}}</text>
    <button class="retry-btn" bindtap="retryOperation">é‡è¯•</button>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <block wx:else>
    
    <!-- æ¯æ—¥æ¨è -->
    <view wx:if="{{randomCocktail}}" 
          class="daily-cocktail-card slide-up" 
          bindtap="onDailyRecommendTap"
          aria-label="æ¯æ—¥æ¨èé…æ–¹">
      <image 
        class="daily-cocktail-image" 
        src="{{randomCocktail.image || '/images/cocktail-of-the-day.jpg'}}" 
        mode="aspectFill"
        lazy-load="true"
        alt="{{randomCocktail.name}}é…æ–¹å›¾ç‰‡" />
      <view class="daily-info">
        <text class="daily-cocktail-title">æ¯æ—¥æ¨èï¼š{{randomCocktail.name}}</text>
        <text class="daily-cocktail-description">{{randomCocktail.description}}</text>
        <view wx:if="{{randomCocktail.difficulty || randomCocktail.time}}" class="daily-meta">
          <text wx:if="{{randomCocktail.difficulty}}" class="meta-item">éš¾åº¦ï¼š{{randomCocktail.difficulty}}</text>
          <text wx:if="{{randomCocktail.time}}" class="meta-item">æ—¶é—´ï¼š{{randomCocktail.time}}</text>
        </view>
      </view>
    </view>

    <!-- æœç´¢æ  -->
    <view class="search-section">
      <view class="search-bar">
        <input 
          bindinput="onSearch" 
          placeholder="ğŸ” æœç´¢é…æ–¹åç§°ã€æˆåˆ†..." 
          value="{{searchQuery}}"
          class="search-input"
          confirm-type="search"
          maxlength="50"
          aria-label="æœç´¢é…æ–¹" />
        <view wx:if="{{searchQuery}}" 
              class="clear-search" 
              bindtap="clearSearch"
              aria-label="æ¸…é™¤æœç´¢">
          <text class="clear-icon">Ã—</text>
        </view>
      </view>
      
      <!-- æœç´¢çŠ¶æ€æç¤º -->
      <view class="search-status">
        <text wx:if="{{isSearching}}" class="search-loading">æœç´¢ä¸­...</text>
        <text wx:elif="{{searchQuery}}" class="search-result">
          æ‰¾åˆ° {{filteredCount}} ä¸ªé…æ–¹
        </text>
        <text wx:else class="total-count">
          å…± {{totalCount}} ä¸ªé…æ–¹
        </text>
      </view>
    </view>

    <!-- é…æ–¹åˆ—è¡¨ -->
    <view class="cocktail-section">
      <view class="section-title">
        {{searchQuery ? 'æœç´¢ç»“æœ' : 'ç»å…¸é…æ–¹'}}
      </view>
      
      <!-- æ— æœç´¢ç»“æœ -->
      <view wx:if="{{searchQuery && filteredCount === 0}}" class="no-results">
        <text class="no-results-text">æœªæ‰¾åˆ°ç›¸å…³é…æ–¹</text>
        <text class="no-results-tip">è¯•è¯•æœç´¢å…¶ä»–å…³é”®è¯</text>
        <button class="clear-search-btn" bindtap="clearSearch">æ¸…é™¤æœç´¢</button>
      </view>
      
      <!-- é…æ–¹åˆ—è¡¨ -->
      <block wx:else>
        <view 
          wx:for="{{filteredCocktails}}" 
          wx:key="id"
          wx:for-item="cocktail"
          data-id="{{cocktail.id}}"
          data-name="{{cocktail.name}}" 
          bindtap="navigateToCocktailDetail"
          class="cocktail-card scale-in"
          style="animation-delay: {{index * 0.1}}s"
          aria-label="{{cocktail.name}}é…æ–¹">
          
          <image 
            class="cocktail-thumbnail" 
            src="{{cocktail.image || '/images/' + cocktail.name + '.jpg'}}" 
            mode="aspectFill"
            lazy-load="true"
            alt="{{cocktail.name}}é…æ–¹å›¾ç‰‡" />
          
          <view class="cocktail-info">
            <view class="cocktail-header">
              <text class="cocktail-name">{{cocktail.name}}</text>
              <view wx:if="{{cocktail.popularity}}" class="popularity">
                <text class="popularity-score">{{cocktail.popularity}}%</text>
              </view>
            </view>
            
            <text class="cocktail-desc">{{cocktail.description}}</text>
            
            <!-- é…æ–¹å…ƒä¿¡æ¯ -->
            <view class="cocktail-meta">
              <text wx:if="{{cocktail.difficulty}}" class="meta-tag difficulty">{{cocktail.difficulty}}</text>
              <text wx:if="{{cocktail.time}}" class="meta-tag time">{{cocktail.time}}</text>
              <text wx:if="{{cocktail.ingredients && cocktail.ingredients.length}}" class="meta-tag ingredients">
                {{cocktail.ingredients.length}}ç§æˆåˆ†
              </text>
            </view>
          </view>
          
          <!-- å³ç®­å¤´ -->
          <view class="cocktail-arrow">
            <text class="arrow-icon">â€º</text>
          </view>
        </view>
        
        <!-- æš‚æ— æ›´å¤šæ•°æ®æç¤º -->
        <view wx:if="{{!hasMore && filteredCount > 0}}" class="no-more">
          <text class="no-more-text">- å·²æ˜¾ç¤ºå…¨éƒ¨é…æ–¹ -</text>
        </view>
      </block>
    </view>

  </block>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <button 
    class="floating-add-button {{isLoading ? 'hidden' : ''}}" 
    bindtap="navigateToAddCocktail"
    aria-label="æ·»åŠ æ–°é…æ–¹">
    <text class="add-icon">+</text>
  </button>

</view>

<!-- æ— éšœç¢æç¤º -->
<view class="sr-only" aria-live="polite">
  <text wx:if="{{isLoading}}">é¡µé¢æ­£åœ¨åŠ è½½</text>
  <text wx:elif="{{error}}">é¡µé¢åŠ è½½å‡ºé”™ï¼š{{error.message}}</text>
  <text wx:elif="{{isSearching}}">æ­£åœ¨æœç´¢é…æ–¹</text>
</view>
